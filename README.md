# Blocking a Log4J Attack with Palo Alto Networks Cloud NGFW
![Palo Alto Networks Logo](/images/PaloAltoNetworksLogo.png)
## Overview
The contents of this Github repository helps to deploy a reference architecture of a Cloud NGFW Clustered deployment on AWS. It includes
- Steps to setup your workspace to run Terraform
- Terraform scripts to deploy the reference architecture.
- Shell scripts to setup the Vulnerable and Attack servers on the EC2 Instances.
- Further steps to deploy the Cloud NGFW resources.
- Steps for demonstrating the Log4J Attack and Blocking the same using the NGFW.
# Lab Topology
![Cloud NGFW East-West Cluster Deployment Reference Architecture](/images/CloudNGFW-EastWest.png)
# Lab Steps
## Initialize Lab
For the purpose of this lab, we will use AWS CloudShell for deploying the AWS Cloud Resources using Terraform.
### Find the SSH Key Pair Name
If you are using QwikLab, the SSH Key Pair should have already been generated by QwikLab. In such case,
- Navigate to EC2 Console -> Key pairs
- Copy and record the name of the Key Pair that was generated by Qwiklabs, e.g. qwikLABS-L17939-10286
- In Qwiklabs console, download the ssh key for later use (PEM and PPK options available)
### Update IAM Policies
- Search for IAM in top search bar (IAM is global)
- In IAM dashboard select Users -> awsstudent
- Expand default_policy, Edit Policy -> Visual Editor
- Find the Deny Action for Cloud Shell and click Remove on the right
- Select Review policy
- Select Save changes
> Qwiklabs has an explicit Deny for CloudShell. However, we have permissions to remove this deny policy. Take a look at the other Deny statements while you are here.
### Launch AWS CloudShell
- Search for cloudshell in top search bar
- Close out of the Intro Screen
- Allow a few moments for it to initialize
> AWS CloudShell already has much of the prerequisites installed like Git, wget, etc so all we need to do is clone this Git Repository.
### Clone the Git Repository
Clone the Repository with the terraform to deploy
```
git clone https://github.com/vsrkrishnan/panw-cloud-ngfw-qwiklab.git
```
### Deploy the Cloud Resources
#### Update the deployment variables in the code
- Change your current working directory to the git repository's root directory
```
cd panw-cloud-ngfw-qwiklab
```
- Open the *student.auto.tfvars* file and update the *region*, *ssh-key-name* and the *prefix-name-tag* variables as required for the lab.
```
vi terraform/cloud-ngfw-lab/student.auto.tfvars
```
- Run the setup script included in the git root directory.
```
./setup.sh
```
- Wait until the Cloud Resource deployment is complete.